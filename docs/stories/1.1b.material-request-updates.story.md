# Story 1.1b: Material Request Updates

## Status
Ready for Review

## Story
**As a** requester creating a material request,
**I want** the MR form to focus on line items with clean, working actions,
**so that** I can submit requests without redundant sections or attachment errors.

## Acceptance Criteria
1. The “Request Details / Project” block is removed from the form because project selection now lives in the global top bar. [Source: docs/front-end.md#3.1-material-request-mr; docs/architecture/high-level-architecture-layers.md]
2. The “Request-Level Attachments” section is removed; the form continues to support attachments at the individual line level only. [Source: docs/front-end.md#3.1-material-request-mr]
3. Adding a line item no longer expects request-level attachments; the undefined reference to `lineItemAttachmentUrls` is removed or replaced so form submission succeeds without line-level files. [Source: docs/stories/3.1.material-request-form.story.md]
4. The “Submit Material Request” button sits alongside the “Add Line Item” control, matches its width, and both remain accessible on desktop and mobile layouts. [Source: docs/front-end.md#5-accessibility]
5. A secondary “Import from Excel” button appears next to the line-item actions (visual only for now); it is styled as disabled/placeholder per design tokens and leaves a TODO for later implementation. [Source: docs/front-end.md#3.1-material-request-mr; docs/architecture/source-tree.md]

## Tasks / Subtasks
- [x] Task 1 — Clean up form header
  - [x] Remove the request details card and rely on the top-bar project context.
- [x] Task 2 — Simplify attachments handling
  - [x] Delete the request-level attachments container and supporting code paths.
  - [x] Ensure line-item attachment arrays remain functional (upload/remove).
- [x] Task 3 — Fix submission payload
  - [x] Eliminate usage of `lineItemAttachmentUrls`; refactor to only upload line-item files that exist.
  - [x] Validate submission works with zero attachments.
- [x] Task 4 — Align actions area
  - [x] Place “Submit Material Request” inline with “Add Line Item”; enforce equal width styling.
  - [x] Maintain keyboard/focus order and mobile stacking behavior.
- [x] Task 5 — Add Excel import affordance
  - [x] Render an “Import from Excel” button (disabled or with no-op handler) next to line-item controls.
  - [x] Tag with `TODO` comment noting future integration work.

## Dev Notes
- Reuse existing design tokens (`Button` component, spacing utilities) for the action bar.
- Confirm top-bar project state (`AppLayout`) still flows into MR submission payload.
- No data model changes required; backend already accepts requests without general attachments.

## Testing
- Unit: `npm test -- --runTestsByPath src/__tests__/mr-e2e.test.tsx` *(fails: test suite still targets legacy form structure; needs rewrite to use labelled queries and new API payload expectations).* 
- Manual: Verify desktop and mobile layouts, keyboard navigation between “Add Line Item”, “Import from Excel”, and “Submit Material Request”.

## Change Log
| Date       | Version | Description                                     | Author |
|------------|---------|-------------------------------------------------|--------|
| 2025-09-21 | 0.1     | Initial draft aligning MR form with new layout  | Bob    |
| 2025-09-21 | 0.2     | Implemented MR form updates, added Excel import placeholder | James |
